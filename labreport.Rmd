---
title: "lab report"
author: "Aaron Willcox"
date: "09/07/2018"
output: html_document
fontsize: 12pt
geometry: margin = 1.2in
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

## R Markdown

This is an R Markdown document. Markdown is a simple formatting syntax for authoring HTML, PDF, and MS Word documents. For more details on using R Markdown see <http://rmarkdown.rstudio.com>.

When you click the **Knit** button a document will be generated that includes both content as well as the output of any embedded R code chunks within the document. You can embed an R code chunk like this:


```{r}
# Included librarys for functions
library(psych)
library(haven)
library(dplyr)
library(ggplot2)
library(stargazer)
library(labelled)
```

# import 
SPSS file into a data frame using the haven package
Reading SPSS-data with haven keeps the numeric values for variables and adds the value and variable labels as attributes.

The core set of items forming the PWI comprise of seven questions of satisfaction with specific life domains as follows:

##### Questions

How satisfied are you with...? | Domains |
1. your standard of living? | Standard of Living |
2. your health?| Personal Health |
3. what you are achieving in life?| Achieving in Life |
4. your personal relationships?|  Personal Relationships |
5. how safe you feel?| Personal Safety |
6. feeling part of your community?| Community-Connectedness|
7. your future security?|  Future Security|

Data derived on the Personal Wellbeing Index scale items may be used either at the level of individual domains, or the domain scores may be aggregated and averaged to form the Personal Wellbeing Index (PWI).

## Personality 
### NEO-PI

## Affect (HPMood) 
### Homeostatically Protected Mood
1. Happy
2. Content
3. Excited

**DV:** Personal Wellbeing Index (pwi)  
**IVs:** Affect(affect), Cogniton(cognition), Gender(gender), Personality(personality), Employment(employment).

***
```{r}

well_being_df <- read_sav("WellbeingFINAL.sav")
attach(well_being_df)
View(well_being_df)
```

Check for missing values and that they are lower than the total number of observations. 
If number of observations with missing values are much lower than the total number of observations, then thereâ€™s not much loss of information by dropping them. 

```{r}
nrows <- nrow(well_being_df)
ncomplete <- sum(complete.cases(well_being_df))
ncomplete/nrows
```


# Take a look at the data
```{r}
describe(well_being_df)
```

# Check for missing or na data
```{r}
which(is.na(well_being_df))
```


# Subsetting and variables setup

Coerce the dummy codings to their labels. The select() function cannot handle character strings as arguments. 
```{r}
#for each gender summarise the mean, sd, min and max values 1 = Male, 2 = Female and 3 = Transgender
# Gender <- select(well_being_df, Gender, Age) %>%
#  mutate(Gender = labelled::to_factor(Gender)) %>%
#  group_by(Gender) %>%
#  summarise_all(funs(mean, n = n(), sd, min(.,is.na = TRUE), max(.,is.na = TRUE)))

# Gender #display table

#For each employment status (1:5) summarise mean, sd min and max values 
# Employment <- select(well_being_df, EmploymentStatus, Gender) %>% 
#  mutate(EmploymentStatus = labelled::to_factor(EmploymentStatus)) %>% # use labelled package 
#  group_by(EmploymentStatus) %>% 
#  summarise_all(funs(mean, n = n(), sd,min(.,is.na = TRUE), max(.,is.na = TRUE)))

# Employment #display table

#check assumptions and distributions



#Create a new column for each variable and mutate to a new column on existing dataframe 

well_being_df <- well_being_df %>% 
  mutate(affect = rowSums(select(., contains("Affect")))) #Affect variable

well_being_df <- well_being_df %>% 
  mutate(pwi_index = rowSums(select(., contains("PWI")))) #PWI Variable - need to select for each domain

well_being_df <- well_being_df %>% 
  mutate(cognition = rowSums(select(., contains("Cognition")))) #Cognition

well_being_df <- well_being_df %>% 
  mutate(Personality = rowSums(select(., contains("Personality")))) #Personality


#What is the average PWI Score for each domain of our sample?
Personal.Wellbeing.Index <- c("Standard of Living", "Personal Health", "Achieving in Life", "Personal Relationships", "Personal Safety", "Community", "Future Security")

PWi.Means <- colSums(well_being_df[4:10]/169*10) #As per the manual - move one decimal to the left
cbind(Personal.Wellbeing.Index, as.numeric(PWi.Means))

#Have a look at some plots - Personal wellbeing and HPMood
ggplot(data = well_being_df, aes(x = well_being_df$affect, y = well_being_df$pwi_index)) +
  geom_point(aes(color = )) +
  theme_bw() +
  ggtitle("Subjective Wellbeing Model") +
  theme( plot.title = element_text(vjust = 1.0) ) +
  xlab("Homostasis Mood Index") +
  theme( axis.title.x = element_text(vjust = -.5) ) +
  ylab("Personal Wellbeing Index") +
  theme( axis.title.y = element_text(vjust = 1.0) ) +
  theme(legend.position = "bottom")

#create a model
my.model <- lm(formula = well_being_df$pwi_index ~ 
                 well_being_df$affect + 
                 well_being_df$cognition + 
                 well_being_df$Personality)

confint(my.model, level = 0.95)

coef(my.model)

summary(my.model)

```

Using the Stargazer library to output cleaner output tables
```{r}
stargazer(my.model, 
          type = "text", 
          style = "all", 
          summary = TRUE, 
          dep.var.labels = "Personal Wellbeing Index", 
          ci = TRUE, digits = 2) #the text prints table to the Console
```




### Inserting html code for table copied from the output: stargazer(my.model, type = "html")

<table style="text-align:center"><tr><td colspan="2" style="border-bottom: 1px solid black"></td></tr><tr><td style="text-align:left"></td><td><em>Dependent variable:</em></td></tr>
<tr><td></td><td colspan="1" style="border-bottom: 1px solid black"></td></tr>
<tr><td style="text-align:left"></td><td>Personal Wellbeing Index</td></tr>
<tr><td colspan="2" style="border-bottom: 1px solid black"></td></tr><tr><td style="text-align:left">affect</td><td>1.00<sup>***</sup></td></tr>
<tr><td style="text-align:left"></td><td>(0.80, 1.21)</td></tr>
<tr><td style="text-align:left"></td><td>t = 9.80</td></tr>
<tr><td style="text-align:left"></td><td>p = 0.00</td></tr>
<tr><td style="text-align:left">cognition</td><td>0.16<sup>***</sup></td></tr>
<tr><td style="text-align:left"></td><td>(0.06, 0.26)</td></tr>
<tr><td style="text-align:left"></td><td>t = 3.03</td></tr>
<tr><td style="text-align:left"></td><td>p = 0.003</td></tr>
<tr><td style="text-align:left">personality</td><td>-0.03</td></tr>
<tr><td style="text-align:left"></td><td>(-0.13, 0.07)</td></tr>
<tr><td style="text-align:left"></td><td>t = -0.62</td></tr>
<tr><td style="text-align:left"></td><td>p = 0.54</td></tr>
<tr><td style="text-align:left">Gender</td><td>-0.65</td></tr>
<tr><td style="text-align:left"></td><td>(-2.29, 1.00)</td></tr>
<tr><td style="text-align:left"></td><td>t = -0.77</td></tr>
<tr><td style="text-align:left"></td><td>p = 0.45</td></tr>
<tr><td style="text-align:left">Constant</td><td>30.06<sup>***</sup></td></tr>
<tr><td style="text-align:left"></td><td>(13.89, 46.24)</td></tr>
<tr><td style="text-align:left"></td><td>t = 3.64</td></tr>
<tr><td style="text-align:left"></td><td>p = 0.0004</td></tr>
<tr><td colspan="2" style="border-bottom: 1px solid black"></td></tr><tr><td style="text-align:left">Observations</td><td>169</td></tr>
<tr><td style="text-align:left">R<sup>2</sup></td><td>0.55</td></tr>
<tr><td style="text-align:left">Adjusted R<sup>2</sup></td><td>0.54</td></tr>
<tr><td style="text-align:left">Residual Std. Error</td><td>5.33 (df = 164)</td></tr>
<tr><td style="text-align:left">F Statistic</td><td>50.82<sup>***</sup> (df = 4; 164) (p = 0.00)</td></tr>
<tr><td colspan="2" style="border-bottom: 1px solid black"></td></tr><tr><td style="text-align:left"><em>Note:</em></td><td style="text-align:right"><sup>*</sup>p<0.1; <sup>**</sup>p<0.05; <sup>***</sup>p<0.01</td></tr>
</table>

***


Note that the `echo = FALSE` parameter was added to the code chunk to prevent printing of the R code that generated the plot.
